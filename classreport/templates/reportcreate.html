<!-- reportcreate.html -->
{% extends 'baselite.html' %}
{% load static %}
{% block content %}
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>

<style>
    .tabs {
        display: flex;
        cursor: pointer;
        margin-bottom: 10px;
    }
    .tab {
        padding: 10px 20px;
        background: #ddd;
        margin-right: 5px;
        border-radius: 5px 5px 0 0;
    }
    .tab.active {
        background: #fff;
        border-bottom: 2px solid #fff;
    }
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }
</style>

<style>
    /* タブのスタイル */
    .tabs {
        display: flex;
        cursor: pointer;
        margin-bottom: 10px;
        flex-wrap: wrap;
    }

    .tab {
        padding: 10px 20px;
        background: #ddd;
        margin-right: 5px;
        border-radius: 5px 5px 0 0;
        font-weight: bold;
    }

    .tab.active {
        background: #fff;
        border-bottom: 2px solid #fff;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* 学生情報テーブル */
    .student-info {
        width: 100%;
        margin-bottom: 20px;
        border-collapse: collapse;
    }

    .student-info td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
        font-size: 14px;
    }

    .student-info td:first-child {
        width: 150px;
        font-weight: bold;
    }

    /* フォームのスタイル */
    form {
        margin-top: 20px;
    }

    label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
    }

    input[type="text"] {
        width: 100%;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-bottom: 15px;
    }

    input[type="text"]:focus {
        border-color: #007bff;
        outline: none;
    }

    button.save-button {
        background-color: #28a745;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.3s;
    }

    button.save-button:hover {
        background-color: #218838;
    }

    /* ボタンのスタイル */
    #add-tab-button {
        background-color: #007bff;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    #add-tab-button:hover {
        background-color: #0056b3;
    }

    /* タブにアクティブ状態を付与 */
    .tabs {
        justify-content: start;
    }

    .tab.active {
        background-color: #f1f1f1;
        border-bottom: 2px solid #007bff;
    }

    /* スクロールバーのデザイン */
    .tabs {
        overflow-x: auto;
    }

    .tabs::-webkit-scrollbar {
        height: 8px;
    }

    .tabs::-webkit-scrollbar-thumb {
        background-color: #007bff;
        border-radius: 10px;
    }

    .tabs::-webkit-scrollbar-track {
        background-color: #f1f1f1;

    }
    .image-options {
    display: flex;
    gap: 10px;
}

.selectable-image {
    width: 100px;
    height: auto;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s;
}

input[type="radio"]:checked + label .selectable-image {
    border-color: blue;
}
</style>

<div class="content-wrapper">
    <section class="content">
        <div class="studentselecter_box">
            <span>教師 </span><span id="teacher-name"></span>
            <div class="tabs">
                <button id="add-tab-button" class="tab">＋</button>
            </div>
            <div id="tab-contents">
                <!-- ここにテンプレートとしてのフォームを準備 -->
                <div id="form-template" class="tab-content">
                    <table class="student-info">
                        <!-- Student情報がここに表示されます -->
                    </table>
                    <form>
                        <label for="form-behindtime">遅刻:</label> 
                            <select name="form-behindtime" id="form-behindtime">
                                <option value="10分">10分</option>
                                <option value="20分">20分</option>
                                <option value="30分以上">30分以上</option>
                            </select>
                        <label for="form-earlytime">早退:</label> 
                            <select name="form-earlytime" id="form-earlytime">
                                <option value="10分">10分</option>
                                <option value="20分">20分</option>
                                <option value="30分以上">30分以上</option>
                            </select>
                        <label for="form-attendance">出欠:</label> 
                            <select name="form-attendance" id="form-attendance">
                                <option value="出席">出席</option>
                                <option value="欠席">欠席</option>
                            </select>
                        <label for="form-achievement">達成度:</label> 
                            <select name="form-achievement" id="form-achievement">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        <label for="form-poster">姿勢:</label> 
                            <select name="form-poster" id="form-poster">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        <label for="form-understand">理解:</label> 
                            <select name="form-understand" id="form-understand">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        <label for="form-parentsmessage">保護者用評価:</label> 
                        <div class="image-options">
                            
                                <input type="radio" id="option1" name="form-parentsmessage" value="1">
                                <label for="option1">
                                    <img src="{% static 'img/option1.png' %}" alt="option1" class="selectable-image">
                                </label>
                                <input type="radio" id="option2" name="form-parentsmessage" value="2">
                                <label for="option2">
                                    <img src="{% static 'img/option2.png' %}" alt="option2" class="selectable-image">
                                </label>
                                <input type="radio" id="option3" name="form-parentsmessage" value="3">
                                <label for="option3">
                                    <img src="{% static 'img/option3.png' %}" alt="option3" class="selectable-image">
                                </label>
                                <input type="radio" id="option4" name="form-parentsmessage" value="4">
                                <label for="option4">
                                    <img src="{% static 'img/option4.png' %}" alt="option4" class="selectable-image">
                                </label>
                                <input type="radio" id="option5" name="form-parentsmessage" value="5">
                                <label for="option5">
                                    <img src="{% static 'img/option5.png' %}" alt="option5" class="selectable-image">
                                </label>
                            
                        </div>
                        <label for="form-teachermessage">指導後コメント:</label> 
                            <input type="text" name="form-teachermessage" id="form-teachermessage">
                        <label for="form-nextlesson">次の授業:</label> 
                            <input type="text" name="form-nextlesson" id="form-nextlesson">
                        <label for="form-homework">次の宿題:</label> 
                            <input type="text" name="form-homework" id="form-homework">
                        <!-- 他のフィールドを追加 -->
                        <button type="button" class="save-button">提出</button>
                    </form>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
$(document).ready(function () {
    var teacherId = '{{ teacher_id }}';

    // Ajax to get teacher and schedule information
    $.ajax({
        url: '{% url "classreport:get_teacher_and_schedules" %}',
        method: 'GET',
        dataType: 'json',
        data: { teacher_id: teacherId },
        success: function (response) {
            // Set the Teacher's name
            $('#teacher-name').text(response.teacher_name);

            // Initialize tabs and forms for all students
            initializeTabs(response.students);
        },
        error: function (error) {
            console.error('Error:', error);
        }
    });

    // Initialize the tabs and forms
    function initializeTabs(students) {
        var firstTab = true;
        $.each(students, function(index, student) {
            createNewTab(student, firstTab);
            firstTab = false;
        });

        // Add event listener for the tab adding button
        $('#add-tab-button').click(function() {
            // Logic for adding a new tab, if needed
        });
    }

    // Create a new tab and form for each student
    function createNewTab(student, isActive) {
        var newTab = $('<div>').addClass('tab').attr('data-tab', student.name).text(student.name);
        $('.tabs').prepend(newTab);

        var newForm = $('#form-template').clone().removeAttr('id').attr('data-student', student.name).hide();
        $('#tab-contents').append(newForm);

        if (isActive) {
            newTab.addClass('active');
            newForm.show().addClass('active');
        }

        newTab.click(function () {
            activateTab($(this), newForm);
        });

        populateStudentInfo(newForm, student);
    }

    // Activate a tab and show the corresponding form
    function activateTab(tab, form) {
        $('.tab, .tab-content').removeClass('active');
        tab.addClass('active');
        form.show().addClass('active').siblings('.tab-content').hide();

        var studentName = form.attr('data-student');
        var savedData = Cookies.getJSON('form_' + studentName) || {};
        fillForm(form, savedData);
    }

    // Populate the student information in the form
    function populateStudentInfo(form, student) {
        var infoHTML = `
            <tr><td>
                    名前: ${student.name}
                </td>
                <td>
                    学校名: ${student.school}
                </td>
                <td>
                    教育段階: ${student.stage}
                </td>
                <td>
                    学年: ${student.grade}
                </td>
                <td>
                    組: ${student.schoolclass}
                </td>
            </tr>
        `;
        form.find('.student-info').html(infoHTML);
    }

    // Save form data to cookies
    $(document).on('click', '.save-button', function () {
        var form = $(this).closest('.tab-content');
        var formData = form.find('form').serializeArray().reduce(function(obj, item) {
            obj[item.name] = item.value;
            return obj;
        }, {});

        var studentName = form.attr('data-student');
        Cookies.set('form_' + studentName, formData, { expires: 1 });
    });

    // Fill form inputs with saved data
    function fillForm(form, data) {
        $.each(data, function(key, value) {
            form.find('[name=' + key + ']').val(value);
        });
    }
});

function scrollToTab(tab) {
    var tabContainer = $('.tabs');
    var tabOffset = tab.offset().left;
    var tabWidth = tab.outerWidth();

    tabContainer.animate({
        scrollLeft: tabOffset - tabContainer.offset().left - (tabContainer.width() / 2) + (tabWidth / 2)
    }, 'fast');
}
</script>

{% endblock content %}